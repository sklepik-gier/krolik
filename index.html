<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kr√≥lik na Polu Marchewek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #86efac;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #86efac 0%, #4ade80 100%);
        }
        .entity {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease-out;
            user-select: none;
        }
        #rabbit {
            font-size: 3.5rem;
            z-index: 10;
            border-radius: 50%;
            transition: box-shadow 0.3s ease, transform 0.2s;
        }
        /* Blue glow for shield */
        #rabbit.shielded {
            box-shadow: 0 0 20px 10px rgba(59, 130, 246, 0.6);
            background: rgba(59, 130, 246, 0.2);
        }
        /* Yellow glow for banana multiplier */
        #rabbit.multiplier-active {
            filter: drop-shadow(0 0 15px #facc15);
        }
        .carrot {
            font-size: 2.2rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            animation: bounce 0.8s infinite alternate;
        }
        .stone {
            font-size: 2.5rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }
        .apple {
            font-size: 2.5rem;
            filter: drop-shadow(0 4px 8px rgba(239, 68, 68, 0.4));
            animation: pulse 0.5s infinite alternate;
        }
        .banana {
            font-size: 2.5rem;
            filter: drop-shadow(0 4px 8px rgba(234, 179, 8, 0.4));
            animation: pulse 0.4s infinite alternate;
        }
        .pineapple {
            font-size: 2.5rem;
            filter: drop-shadow(0 4px 8px rgba(234, 179, 8, 0.6));
            animation: pulse 0.6s infinite alternate;
        }
        @keyframes bounce {
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(-12px) rotate(10deg); }
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
        .score-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 24px;
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            font-size: 1.6rem;
            font-weight: 800;
            color: #c2410c;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border: 2px solid #fb923c;
        }
        .status-badge {
            font-size: 0.85rem;
            letter-spacing: 1px;
            font-weight: 600;
            margin-top: 4px;
            display: none;
        }
        #speed-info { color: #ea580c; display: block; }
        #shield-status { color: #2563eb; }
        #multiplier-status { color: #a16207; }
        
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
            text-align: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        .btn {
            background: #f97316;
            color: white;
            padding: 18px 50px;
            border-radius: 40px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 25px;
            box-shadow: 0 4px 0 #9a3412;
        }
        .btn:hover {
            background: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #7c2d12;
        }
        .popup-text {
            animation: fadeUp 0.8s ease-out forwards;
            position: absolute;
            font-weight: 900;
            pointer-events: none;
            font-size: 2rem;
            z-index: 50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        @keyframes fadeUp {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-60px) scale(1); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="score-panel">
        <div>Marchewki: <span id="score">0</span></div>
        <div id="speed-info" class="status-badge">Trudno≈õƒá: <span id="speed-val">1.0</span>x</div>
        <div id="shield-status" class="status-badge">üõ°Ô∏è TARCZA AKTYWNA</div>
        <div id="multiplier-status" class="status-badge">üçå MNO≈ªNIK x2 (<span id="mult-timer">5</span>s)</div>
    </div>
    <div id="rabbit" class="entity">üêá</div>
</div>

<div id="overlay">
    <h1 id="status-title" class="text-5xl font-black mb-6 text-orange-500">G≈Çodny Kr√≥lik</h1>
    <p id="status-msg" class="text-2xl mb-4">Zbieraj marchewki i unikaj kamieni!</p>
    <ul class="text-left bg-white/10 p-6 rounded-2xl mb-6 space-y-2">
        <li>ü•ï Zbieraj marchewki (+1 pkt)</li>
        <li>ü™® Unikaj kamieni (Koniec gry)</li>
        <li>üçé Jab≈Çko (co 15-20 pkt) = üõ°Ô∏è Tarcza ochronna</li>
        <li>üçå Banan (co 10-20 pkt) = 2x Marchewki przez 5 sekund!</li>
        <li>üçç Ananas (co 30-40 pkt) = üéÅ Mega bonus +10 pkt!</li>
        <li>‚ö†Ô∏è Ka≈ºda niezebrana marchewka to -1 pkt</li>
        <li>‚ùå Gra ko≈Ñczy siƒô, gdy punkty spadnƒÖ poni≈ºej 0</li>
    </ul>
    <button class="btn" onclick="startGame()">Zacznij zbieraƒá!</button>
</div>

<script>
    const container = document.getElementById('game-container');
    const rabbit = document.getElementById('rabbit');
    const scoreElement = document.getElementById('score');
    const speedElement = document.getElementById('speed-val');
    const shieldStatus = document.getElementById('shield-status');
    const multiplierStatus = document.getElementById('multiplier-status');
    const multTimerElement = document.getElementById('mult-timer');
    const overlay = document.getElementById('overlay');
    const statusTitle = document.getElementById('status-title');
    const statusMsg = document.getElementById('status-msg');

    let score = 0;
    let baseSpeed = 3;
    let speedMultiplier = 1;
    let isGameRunning = false;
    let hasShield = false;
    let isDoubleMultiplier = false;
    let multiplierTimer = null;
    let rabbitPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    let entities = [];
    let gameLoop;
    let spawnTimer;
    
    // Progi pojawiania siƒô bonus√≥w
    let nextAppleScore = 15;      // Pierwsze jab≈Çko ok 15 pkt
    let nextPineappleScore = 30;  // Pierwszy ananas ok 30 pkt
    let nextBananaScore = 10;     // Pierwszy banan ok 10 pkt

    function updateRabbitPosition() {
        rabbit.style.left = `${rabbitPos.x - rabbit.offsetWidth / 2}px`;
        rabbit.style.top = `${rabbitPos.y - rabbit.offsetHeight / 2}px`;
    }

    function handleMove(e) {
        if (!isGameRunning) return;
        const x = e.clientX || (e.touches && e.touches[0].clientX);
        const y = e.clientY || (e.touches && e.touches[0].clientY);
        
        if (x && y) {
            rabbitPos.x = x;
            rabbitPos.y = y;
            updateRabbitPosition();
        }
    }

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleMove(e);
    }, { passive: false });

    function spawnEntity() {
        if (!isGameRunning) return;

        let type = 'carrot';
        
        // Power-up: Ananas co 30-40 punkt√≥w (Bonus +10)
        if (score >= nextPineappleScore) {
            type = 'pineapple';
            nextPineappleScore = score + Math.floor(Math.random() * 11) + 30;
        }
        // Power-up: Jab≈Çko co 15-20 punkt√≥w (Tarcza)
        else if (score >= nextAppleScore) {
            type = 'apple';
            // Losuj kolejny pr√≥g pojawienia siƒô (15-20 pkt od obecnego wyniku)
            nextAppleScore = score + Math.floor(Math.random() * 6) + 15;
        } 
        // Power-up: Banan co ok. 10-20 punkt√≥w (Mno≈ºnik)
        else if (score >= nextBananaScore) {
            type = 'banana';
            nextBananaScore = score + Math.floor(Math.random() * 11) + 10;
        } 
        else {
            type = Math.random() > 0.4 ? 'carrot' : 'stone';
        }

        const element = document.createElement('div');
        element.className = `entity ${type}`;
        
        if (type === 'carrot') element.innerHTML = 'ü•ï';
        else if (type === 'stone') element.innerHTML = 'ü™®';
        else if (type === 'apple') element.innerHTML = 'üçé';
        else if (type === 'banana') element.innerHTML = 'üçå';
        else if (type === 'pineapple') element.innerHTML = 'üçç';
        
        const x = Math.random() * (window.innerWidth - 60);
        const y = -80;
        
        const entityObj = {
            el: element,
            type: type,
            x: x,
            y: y,
            velocity: (baseSpeed + Math.random() * 2) * speedMultiplier
        };

        container.appendChild(element);
        entities.push(entityObj);
    }

    function updateGame() {
        speedMultiplier += 0.0003;
        speedElement.innerText = speedMultiplier.toFixed(2);

        for (let i = entities.length - 1; i >= 0; i--) {
            const ent = entities[i];
            ent.y += ent.velocity;
            ent.el.style.top = `${ent.y}px`;
            ent.el.style.left = `${ent.x}px`;

            const rabbitRect = rabbit.getBoundingClientRect();
            const entRect = ent.el.getBoundingClientRect();

            const dx = (entRect.left + entRect.width/2) - (rabbitRect.left + rabbitRect.width/2);
            const dy = (entRect.top + entRect.height/2) - (rabbitRect.top + rabbitRect.height/2);
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 50) {
                if (ent.type === 'carrot') {
                    collectCarrot(i);
                } else if (ent.type === 'apple') {
                    collectApple(i);
                } else if (ent.type === 'banana') {
                    collectBanana(i);
                } else if (ent.type === 'pineapple') {
                    collectPineapple(i);
                } else if (ent.type === 'stone') {
                    if (hasShield) {
                        breakShield(i);
                    } else {
                        gameOver("Uderzy≈Çe≈õ w kamie≈Ñ!");
                    }
                }
                continue;
            }

            if (ent.y > window.innerHeight) {
                if (ent.type === 'carrot') {
                    missedCarrot(ent.x);
                }
                ent.el.remove();
                entities.splice(i, 1);
            }
        }
    }

    function collectCarrot(index) {
        const points = isDoubleMultiplier ? 2 : 1;
        score += points;
        updateScoreDisplay();
        
        showPopupText(entities[index].x, entities[index].y, isDoubleMultiplier ? "+2" : "+1", "text-orange-600");
        
        entities[index].el.remove();
        entities.splice(index, 1);
        
        rabbit.style.transform = 'scale(1.4) rotate(15deg)';
        setTimeout(() => rabbit.style.transform = 'scale(1) rotate(0deg)', 150);
    }

    function collectApple(index) {
        hasShield = true;
        rabbit.classList.add('shielded');
        shieldStatus.style.display = 'block';
        showPopupText(entities[index].x, entities[index].y, "üõ°Ô∏è TARCZA!", "text-blue-500");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function collectPineapple(index) {
        score += 10;
        updateScoreDisplay();
        
        showPopupText(entities[index].x, entities[index].y, "üçç +10 PKT!", "text-yellow-600");
        
        entities[index].el.remove();
        entities.splice(index, 1);
        
        container.style.backgroundColor = '#fef08a';
        setTimeout(() => container.style.backgroundColor = '', 200);
    }

    function collectBanana(index) {
        if (multiplierTimer) clearTimeout(multiplierTimer);
        
        isDoubleMultiplier = true;
        rabbit.classList.add('multiplier-active');
        multiplierStatus.style.display = 'block';
        
        let timeLeft = 5;
        multTimerElement.innerText = timeLeft;
        
        if (window.bananaInterval) clearInterval(window.bananaInterval);

        window.bananaInterval = setInterval(() => {
            timeLeft--;
            multTimerElement.innerText = timeLeft;
            if (timeLeft <= 0) clearInterval(window.bananaInterval);
        }, 1000);

        multiplierTimer = setTimeout(() => {
            isDoubleMultiplier = false;
            rabbit.classList.remove('multiplier-active');
            multiplierStatus.style.display = 'none';
        }, 5000);

        showPopupText(entities[index].x, entities[index].y, "üçå 2x PKT!", "text-yellow-500");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function breakShield(index) {
        hasShield = false;
        rabbit.classList.remove('shielded');
        shieldStatus.style.display = 'none';
        showPopupText(rabbitPos.x, rabbitPos.y - 40, "üí• OCHRONA!", "text-blue-400");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function showPopupText(x, y, text, colorClass) {
        const indicator = document.createElement('div');
        indicator.className = `popup-text ${colorClass}`;
        indicator.innerText = text;
        indicator.style.left = `${x}px`;
        indicator.style.top = `${y}px`;
        container.appendChild(indicator);
        setTimeout(() => indicator.remove(), 800);
    }

    function missedCarrot(x) {
        score--;
        updateScoreDisplay();

        if (score < 0) {
            gameOver("Kr√≥lik jest zbyt g≈Çodny!");
            return;
        }

        const indicator = document.createElement('div');
        indicator.className = 'popup-text text-red-500';
        indicator.innerText = '-1';
        indicator.style.left = `${x}px`;
        indicator.style.bottom = '60px';
        container.appendChild(indicator);
        setTimeout(() => indicator.remove(), 800);
    }

    function updateScoreDisplay() {
        scoreElement.innerText = score;
    }

    function startGame() {
        score = 0;
        speedMultiplier = 1;
        hasShield = false;
        isDoubleMultiplier = false;
        
        // Reset prog√≥w
        nextAppleScore = Math.floor(Math.random() * 6) + 15;
        nextPineappleScore = Math.floor(Math.random() * 11) + 30;
        nextBananaScore = Math.floor(Math.random() * 11) + 10;
        
        if (multiplierTimer) clearTimeout(multiplierTimer);
        if (window.bananaInterval) clearInterval(window.bananaInterval);
        
        rabbit.classList.remove('shielded', 'multiplier-active');
        shieldStatus.style.display = 'none';
        multiplierStatus.style.display = 'none';
        
        updateScoreDisplay();
        entities.forEach(ent => ent.el.remove());
        entities = [];
        isGameRunning = true;
        overlay.style.display = 'none';
        
        updateRabbitPosition();

        gameLoop = setInterval(updateGame, 1000 / 60);
        spawnTimer = setInterval(spawnEntity, 700);
    }

    function gameOver(reason) {
        isGameRunning = false;
        clearInterval(gameLoop);
        clearInterval(spawnTimer);
        if (multiplierTimer) clearTimeout(multiplierTimer);
        if (window.bananaInterval) clearInterval(window.bananaInterval);
        
        statusTitle.innerText = "Koniec gry!";
        statusTitle.className = "text-5xl font-black mb-6 text-red-500";
        statusMsg.innerText = `${reason}\nZebra≈Çe≈õ: ${Math.max(0, score)} ü•ï\nPrƒôdko≈õƒá ko≈Ñcowa: ${speedMultiplier.toFixed(2)}x`;
        overlay.style.display = 'flex';
        
        container.style.animation = 'shake 0.5s';
        setTimeout(() => container.style.animation = '', 500);
    }

    window.addEventListener('resize', () => {
        if (!isGameRunning) {
            rabbitPos.x = window.innerWidth / 2;
            rabbitPos.y = window.innerHeight / 2;
            updateRabbitPosition();
        }
    });

    updateRabbitPosition();
</script>

<style>
    @keyframes shake {
        0% { transform: translate(1px, 1px) rotate(0deg); }
        10% { transform: translate(-1px, -2px) rotate(-1deg); }
        20% { transform: translate(-3px, 0px) rotate(1deg); }
        30% { transform: translate(3px, 2px) rotate(0deg); }
        40% { transform: translate(1px, -1px) rotate(1deg); }
        50% { transform: translate(-1px, 2px) rotate(-1deg); }
        60% { transform: translate(-3px, 1px) rotate(0deg); }
        70% { transform: translate(3px, 1px) rotate(-1deg); }
        80% { transform: translate(-1px, -1px) rotate(1deg); }
        90% { transform: translate(1px, 2px) rotate(0deg); }
        100% { transform: translate(1px, -2px) rotate(-1deg); }
    }
</style>

</body>
</html>
