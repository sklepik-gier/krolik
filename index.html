<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kr√≥lik na Polu Marchewek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #86efac;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #86efac 0%, #4ade80 100%);
        }
        .entity {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease-out;
            user-select: none;
        }
        #rabbit {
            font-size: 3.8rem;
            z-index: 10;
            border-radius: 50%;
            transition: box-shadow 0.3s ease;
        }
        
        .jumping {
            animation: rabbit-jump 0.3s ease-out;
        }

        @keyframes rabbit-jump {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.2) translateY(-30px); }
            100% { transform: scale(1) translateY(0); }
        }

        #rabbit.shielded {
            box-shadow: 0 0 25px 12px rgba(59, 130, 246, 0.6);
            background: rgba(59, 130, 246, 0.2);
        }
        #rabbit.multiplier-active {
            filter: drop-shadow(0 0 18px #facc15);
        }
        .carrot {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            animation: bounce 0.8s infinite alternate;
        }
        .stone {
            font-size: 2.8rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }
        .apple {
            font-size: 2.8rem;
            filter: drop-shadow(0 4px 8px rgba(239, 68, 68, 0.4));
            animation: pulse 0.5s infinite alternate;
        }
        .banana {
            font-size: 2.8rem;
            filter: drop-shadow(0 4px 8px rgba(234, 179, 8, 0.4));
            animation: pulse 0.4s infinite alternate;
        }
        .pineapple {
            font-size: 2.8rem;
            filter: drop-shadow(0 4px 8px rgba(34, 197, 94, 0.4));
            animation: pulse 0.6s infinite alternate;
        }
        .coconut {
            font-size: 2.8rem;
            filter: drop-shadow(0 4px 8px rgba(120, 53, 15, 0.4));
            animation: pulse 0.7s infinite alternate;
        }
        .seagull {
            font-size: 3rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
            z-index: 20;
        }

        @keyframes bounce {
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(-12px) rotate(10deg); }
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
        .score-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 24px;
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            font-size: 1.6rem;
            font-weight: 800;
            color: #c2410c;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border: 2px solid #fb923c;
        }
        .status-badge {
            font-size: 0.9rem;
            letter-spacing: 1px;
            font-weight: 600;
            margin-top: 4px;
            display: none;
        }
        #speed-info { color: #ea580c; display: block; }
        #shield-status { color: #2563eb; }
        #multiplier-status { color: #a16207; }
        
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
            text-align: center;
            padding: 20px;
            backdrop-filter: blur(8px);
        }
        .btn {
            background: #f97316;
            color: white;
            padding: 16px 45px;
            border-radius: 40px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 20px;
            box-shadow: 0 4px 0 #9a3412;
        }
        .btn:hover {
            background: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #7c2d12;
        }
        .popup-text {
            animation: fadeUp 0.8s ease-out forwards;
            position: absolute;
            font-weight: 900;
            pointer-events: none;
            font-size: 2.2rem;
            z-index: 50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        @keyframes fadeUp {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-60px) scale(1); }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            text-align: center;
            width: 100%;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stat-label {
            display: block;
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 2px;
            color: white;
        }
        .stat-value {
            font-weight: 900;
            font-size: 1.3rem;
        }
        .color-apple { color: #f87171; }
        .color-banana { color: #facc15; }
        .color-pineapple { color: #4ade80; }
        .color-coconut { color: #a8a29e; }
        .color-speed { color: #fb923c; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="score-panel">
        <div>Marchewki: <span id="score">0</span></div>
        <div id="speed-info" class="status-badge">Trudno≈õƒá: <span id="speed-val">1.0</span>x</div>
        <div id="shield-status" class="status-badge">üõ°Ô∏è TARCZA AKTYWNA</div>
        <div id="multiplier-status" class="status-badge">üçå MNO≈ªNIK x2 (<span id="mult-timer">5</span>s)</div>
    </div>
    <div id="rabbit" class="entity">üêá</div>
</div>

<div id="overlay">
    <h1 id="status-title" class="text-5xl font-black mb-6 text-orange-500 italic drop-shadow-md">G≈Çodny Kr√≥lik</h1>
    
    <div id="game-results" class="hidden w-full max-w-sm">
        <p id="status-msg" class="text-xl mb-4 text-white font-bold"></p>
        <div class="stats-grid mb-6">
            <div class="stat-box">
                <span class="stat-label">üçé Jab≈Çka</span>
                <span id="stat-apples" class="stat-value color-apple">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">üçå Banany</span>
                <span id="stat-bananas" class="stat-value color-banana">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">üçç Ananasy</span>
                <span id="stat-pineapples" class="stat-value color-pineapple">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">ü•• Kokosy</span>
                <span id="stat-coconuts" class="stat-value color-coconut">0</span>
            </div>
            <div class="stat-box col-span-2">
                <span class="stat-label">‚ö° Prƒôdko≈õƒá Ko≈Ñcowa</span>
                <span id="stat-speed" class="stat-value color-speed">1.0x</span>
            </div>
        </div>
    </div>
    
    <div id="instructions" class="w-full max-w-sm">
        <p class="text-xl mb-4 text-white font-medium">Zbieraj marchewki i unikaj kamieni!</p>
        <ul class="text-left bg-white/10 p-5 rounded-2xl mb-6 space-y-2 text-base text-white border border-white/20">
            <li>ü•ï Marchewka = +1 pkt</li>
            <li>ü™® Kamie≈Ñ = Koniec gry</li>
            <li>üïäÔ∏è Mewa (od 100 pkt) = Atakuje z boku! ‚ò†Ô∏è</li>
            <li>üçé Jab≈Çko = üõ°Ô∏è Tarcza ochronna</li>
            <li>üçå Banan = 2x Marchewki (5 sek)</li>
            <li>üçç Ananas = üåü +10 punkt√≥w!</li>
            <li>ü•• Kokos = ‚ùÑÔ∏è Spowolnienie gry!</li>
            <li class="font-bold text-orange-300">‚ö†Ô∏è Niezebrana marchewka = -1 pkt</li>
            <li class="font-bold text-red-400">‚ùå Gra ko≈Ñczy siƒô przy punktach poni≈ºej 0!</li>
        </ul>
    </div>
    
    <button class="btn" onclick="startGame()">Nakarm kr√≥lika</button>
</div>

<script>
    const container = document.getElementById('game-container');
    const rabbit = document.getElementById('rabbit');
    const scoreElement = document.getElementById('score');
    const speedElement = document.getElementById('speed-val');
    const shieldStatus = document.getElementById('shield-status');
    const multiplierStatus = document.getElementById('multiplier-status');
    const multTimerElement = document.getElementById('mult-timer');
    const overlay = document.getElementById('overlay');
    const statusTitle = document.getElementById('status-title');
    const statusMsg = document.getElementById('status-msg');
    const instructions = document.getElementById('instructions');
    const gameResults = document.getElementById('game-results');

    let collectedApples = 0;
    let collectedBananas = 0;
    let collectedPineapples = 0;
    let collectedCoconuts = 0;

    let score = 0;
    let baseSpeed = 3.2;
    let speedMultiplier = 1;
    let isGameRunning = false;
    let hasShield = false;
    let isDoubleMultiplier = false;
    let multiplierTimer = null;
    let rabbitPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    let entities = [];
    let gameLoop;
    let spawnTimer;
    
    // Konfiguracja prog√≥w pojawiania siƒô i flagi limitu (1 na przedzia≈Ç)
    let lastAppleRound = -1;
    let nextBananaScore = 15;
    let bananaSpawnedThisRound = false;
    let nextPineappleScore = 30;
    let pineappleSpawnedThisRound = false;
    let coconutSpawnedThisRound = false;

    function updateRabbitPosition() {
        rabbit.style.left = `${rabbitPos.x - rabbit.offsetWidth / 2}px`;
        rabbit.style.top = `${rabbitPos.y - rabbit.offsetHeight / 2}px`;
    }

    function rabbitJump() {
        rabbit.classList.remove('jumping');
        void rabbit.offsetWidth; 
        rabbit.classList.add('jumping');
    }

    function handleMove(e) {
        if (!isGameRunning) return;
        const x = e.clientX || (e.touches && e.touches[0].clientX);
        const y = e.clientY || (e.touches && e.touches[0].clientY);
        
        if (x && y) {
            rabbitPos.x = x;
            rabbitPos.y = y;
            updateRabbitPosition();
        }
    }

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleMove(e);
    }, { passive: false });

    function spawnEntity() {
        if (!isGameRunning) return;

        let type = 'carrot';
        let x = 0;
        let y = -80;
        let vx = 0;
        let vy = 0;

        // Szansa na mewƒô (po 100 pkt)
        if (score >= 100 && Math.random() < 0.08) {
            type = 'seagull';
            const side = Math.random() > 0.5 ? 'left' : 'right';
            y = Math.random() * (window.innerHeight * 0.6) + 50;
            
            if (side === 'left') {
                x = -80;
                vx = (3 + Math.random() * 3) * speedMultiplier;
            } else {
                x = window.innerWidth + 80;
                vx = -(3 + Math.random() * 3) * speedMultiplier;
            }
        } 
        else {
            const currentAppleRound = Math.floor(score / 15);
            
            // Jab≈Çko: max 1 na ka≈ºde 15 pkt
            if (score > 0 && score % 15 === 0 && lastAppleRound !== currentAppleRound) {
                type = 'apple';
                lastAppleRound = currentAppleRound;
            } 
            // Kokos: max 1 w przedziale 100 - 150
            else if (score >= 100 && score <= 150 && !coconutSpawnedThisRound) {
                type = 'coconut';
                coconutSpawnedThisRound = true;
            }
            // Ananas: max 1 w swoim losowym oknie
            else if (score >= nextPineappleScore && !pineappleSpawnedThisRound) {
                type = 'pineapple';
                pineappleSpawnedThisRound = true;
                // Planujemy kolejny po zebraniu/znikniƒôciu aktualnego progu (reset flagi w logice punktowej)
            }
            // Banan: max 1 w swoim losowym oknie
            else if (score >= nextBananaScore && !bananaSpawnedThisRound) {
                type = 'banana';
                bananaSpawnedThisRound = true;
            } 
            else {
                type = Math.random() > 0.4 ? 'carrot' : 'stone';
            }

            // Obs≈Çuga resetowania flag dla kolejnych losowych przedzia≈Ç√≥w
            if (score > nextPineappleScore + 20) {
                nextPineappleScore = score + Math.floor(Math.random() * 11) + 30;
                pineappleSpawnedThisRound = false;
            }
            if (score > nextBananaScore + 15) {
                nextBananaScore = score + Math.floor(Math.random() * 11) + 15;
                bananaSpawnedThisRound = false;
            }
            
            x = Math.random() * (window.innerWidth - 60);
            y = -80;
            vy = (baseSpeed + Math.random() * 2) * speedMultiplier;
        }

        const element = document.createElement('div');
        element.className = `entity ${type}`;
        
        if (type === 'carrot') element.innerHTML = 'ü•ï';
        else if (type === 'stone') element.innerHTML = 'ü™®';
        else if (type === 'apple') element.innerHTML = 'üçé';
        else if (type === 'banana') element.innerHTML = 'üçå';
        else if (type === 'pineapple') element.innerHTML = 'üçç';
        else if (type === 'coconut') element.innerHTML = 'ü••';
        else if (type === 'seagull') {
            element.innerHTML = 'üïäÔ∏è';
            if (vx > 0) element.style.transform = 'scaleX(-1)';
        }
        
        const entityObj = {
            el: element,
            type: type,
            x: x,
            y: y,
            vx: vx,
            vy: vy
        };

        container.appendChild(element);
        entities.push(entityObj);
    }

    function updateGame() {
        speedMultiplier += 0.00035;
        speedElement.innerText = speedMultiplier.toFixed(2);

        for (let i = entities.length - 1; i >= 0; i--) {
            const ent = entities[i];
            
            ent.x += ent.vx;
            ent.y += ent.vy;
            
            ent.el.style.top = `${ent.y}px`;
            ent.el.style.left = `${ent.x}px`;

            const rabbitRect = rabbit.getBoundingClientRect();
            const entRect = ent.el.getBoundingClientRect();

            const dx = (entRect.left + entRect.width/2) - (rabbitRect.left + rabbitRect.width/2);
            const dy = (entRect.top + entRect.height/2) - (rabbitRect.top + rabbitRect.height/2);
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 60) {
                if (ent.type === 'carrot') collectCarrot(i);
                else if (ent.type === 'apple') collectApple(i);
                else if (ent.type === 'banana') collectBanana(i);
                else if (ent.type === 'pineapple') collectPineapple(i);
                else if (ent.type === 'coconut') collectCoconut(i);
                else if (ent.type === 'stone') {
                    if (hasShield) breakShield(i);
                    else gameOver("Uderzy≈Çe≈õ w kamie≈Ñ!");
                }
                else if (ent.type === 'seagull') {
                    if (hasShield) breakShield(i);
                    else gameOver("Zaatakowa≈Ça Ciƒô mewa!");
                }
                continue;
            }

            if (ent.y > window.innerHeight + 100 || ent.x < -150 || ent.x > window.innerWidth + 150) {
                if (ent.type === 'carrot') missedCarrot(ent.x);
                ent.el.remove();
                entities.splice(i, 1);
            }
        }
    }

    function collectCarrot(index) {
        const points = isDoubleMultiplier ? 2 : 1;
        score += points;
        updateScoreDisplay();
        rabbitJump(); 
        showPopupText(entities[index].x, entities[index].y, isDoubleMultiplier ? "+2" : "+1", "text-orange-600");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function collectApple(index) {
        collectedApples++;
        hasShield = true;
        rabbit.classList.add('shielded');
        shieldStatus.style.display = 'block';
        rabbitJump(); 
        showPopupText(entities[index].x, entities[index].y, "üõ°Ô∏è TARCZA!", "text-blue-500");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function collectBanana(index) {
        collectedBananas++;
        if (multiplierTimer) clearTimeout(multiplierTimer);
        isDoubleMultiplier = true;
        rabbit.classList.add('multiplier-active');
        multiplierStatus.style.display = 'block';
        rabbitJump(); 
        let timeLeft = 5;
        multTimerElement.innerText = timeLeft;
        if (window.bananaInterval) clearInterval(window.bananaInterval);
        window.bananaInterval = setInterval(() => {
            timeLeft--;
            multTimerElement.innerText = timeLeft;
            if (timeLeft <= 0) clearInterval(window.bananaInterval);
        }, 1000);
        multiplierTimer = setTimeout(() => {
            isDoubleMultiplier = false;
            rabbit.classList.remove('multiplier-active');
            multiplierStatus.style.display = 'none';
        }, 5000);
        showPopupText(entities[index].x, entities[index].y, "üçå 2x PKT!", "text-yellow-500");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function collectPineapple(index) {
        collectedPineapples++;
        score += 10;
        updateScoreDisplay();
        rabbitJump(); 
        showPopupText(entities[index].x, entities[index].y, "+10 PKT!", "text-green-600");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function collectCoconut(index) {
        collectedCoconuts++;
        speedMultiplier = Math.max(1.0, speedMultiplier - 1.0);
        rabbitJump();
        showPopupText(entities[index].x, entities[index].y, "‚ùÑÔ∏è SPOWOLNIENIE!", "text-amber-800");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function breakShield(index) {
        hasShield = false;
        rabbit.classList.remove('shielded');
        shieldStatus.style.display = 'none';
        showPopupText(rabbitPos.x, rabbitPos.y - 40, "üí• OCHRONA!", "text-blue-400");
        entities[index].el.remove();
        entities.splice(index, 1);
    }

    function showPopupText(x, y, text, colorClass) {
        const indicator = document.createElement('div');
        indicator.className = `popup-text ${colorClass}`;
        indicator.innerText = text;
        indicator.style.left = `${x}px`;
        indicator.style.top = `${y}px`;
        container.appendChild(indicator);
        setTimeout(() => indicator.remove(), 800);
    }

    function missedCarrot(x) {
        score--;
        updateScoreDisplay();
        if (score < 0) {
            gameOver("Kr√≥lik jest zbyt g≈Çodny!");
            return;
        }
        const indicator = document.createElement('div');
        indicator.className = 'popup-text text-red-500';
        indicator.innerText = '-1';
        indicator.style.left = `${x}px`;
        indicator.style.bottom = '60px';
        container.appendChild(indicator);
        setTimeout(() => indicator.remove(), 800);
    }

    function updateScoreDisplay() {
        scoreElement.innerText = score;
    }

    function startGame() {
        score = 0;
        speedMultiplier = 1;
        hasShield = false;
        isDoubleMultiplier = false;
        
        // Reset flag przedzia≈Ç√≥w
        lastAppleRound = -1;
        nextBananaScore = 15;
        bananaSpawnedThisRound = false;
        nextPineappleScore = 30;
        pineappleSpawnedThisRound = false;
        coconutSpawnedThisRound = false;
        
        collectedApples = 0;
        collectedBananas = 0;
        collectedPineapples = 0;
        collectedCoconuts = 0;

        if (multiplierTimer) clearTimeout(multiplierTimer);
        if (window.bananaInterval) clearInterval(window.bananaInterval);
        
        rabbit.classList.remove('shielded', 'multiplier-active', 'jumping');
        shieldStatus.style.display = 'none';
        multiplierStatus.style.display = 'none';
        updateScoreDisplay();
        
        entities.forEach(ent => ent.el.remove());
        entities = [];
        
        isGameRunning = true;
        overlay.style.display = 'none';
        instructions.style.display = 'none';
        gameResults.classList.add('hidden');
        
        updateRabbitPosition();
        gameLoop = setInterval(updateGame, 1000 / 60);
        spawnTimer = setInterval(spawnEntity, 750);
    }

    function gameOver(reason) {
        isGameRunning = false;
        clearInterval(gameLoop);
        clearInterval(spawnTimer);
        
        statusTitle.innerText = "Koniec gry!";
        statusTitle.className = "text-5xl font-black mb-6 text-orange-500 italic drop-shadow-lg";
        statusMsg.innerText = `${reason}\nZebra≈Çe≈õ: ${Math.max(0, score)} ü•ï`;
        
        document.getElementById('stat-apples').innerText = collectedApples;
        document.getElementById('stat-bananas').innerText = collectedBananas;
        document.getElementById('stat-pineapples').innerText = collectedPineapples;
        document.getElementById('stat-coconuts').innerText = collectedCoconuts;
        document.getElementById('stat-speed').innerText = speedMultiplier.toFixed(2) + "x";
        
        overlay.style.display = 'flex';
        instructions.style.display = 'none';
        gameResults.classList.remove('hidden');
        
        container.style.animation = 'shake 0.5s';
        setTimeout(() => container.style.animation = '', 500);
    }

    updateRabbitPosition();
</script>
</body>
</html>
